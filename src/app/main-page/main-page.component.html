<div>
    <div id="vstupy" class="form">
        <form class="input-form">
	     	<div class="row-layout container-fluid form-header">
	     		<h3>Zadání</h3>
	     		<i class="fa fa-fw fa-plus clickable" (click)="pridejPromennou()"></i>
	     	</div>

			<div class="promenne-scroll container-fluid">
	            <div *ngFor="let r of listPromennych, index as i" class="row form-group">
	            	<fieldset [disabled]="!r.aktivni">
		             	<div class="col-sm-1">{{r.nazev}}</div>
			                <div class="col-sm-11" *ngIf="r.aktivni">
			                	<i class="fa fa-cog clickable" (click)="openDialogOmezeni(r)"></i>
			                	<i class="fa fa-ban text-danger clickable rowHover" (click)="r.aktivni = false"></i>
			                	<i class="fa fa-remove text-danger clickable rowHover" (click)="odeberPromennou(r)"></i>
			                </div>
			                <div class="col-sm-11" *ngIf="!r.aktivni">
			                	<i class="fa fa-cog clickable" style="visibility: hidden"></i>
			                	<i class="fa fa-check-circle text-success clickable rowHover" (click)="r.aktivni = true"></i>
			                </div>
			                <div class="clearfix"></div>
			                
			                <div class="col-sm-1"></div>
			            	<div class="col-sm-11">
			                 	 <span class="operator">=</span> &#123;
			                 	 <input name="domena{{r.nazev}}" [(ngModel)]="r.domena" required numbersConvertor pattern="^(-?\d+,? ?)*-?\d+$" #domenaControl="ngModel" class="surrounded" />
			                 	 &#125;
			                </div>
		                 	<div class="clearfix"></div>
		                 
		                 	<div class="col-sm-1"></div>
			             	<div class="col-sm-11">
			             		<div *ngIf="domenaControl.invalid && (domenaControl.dirty || domenaControl.touched)" class="text text-danger">
			             			Povolena jsou celá čísla oddělená čárkou
			             		</div>
			                </div>
		                
			                <div *ngFor="let o of r.omezeni" class="">
			                 	<div class="col-sm-1"></div>
			              	<div class="col-sm-11">
		                 		<span class="operator">{{o.typOmezeni}}{{o.omezeniProPromennou}}</span> {{o.hodnotyOmezeni}}
		                 	</div>
		                 </div>
		         	</fieldset>
	            </div>
	        </div>
        </form>

        <form  (ngSubmit)="run()" #provedeniForm="ngForm" class="input-form ">
        	<div class="container-fluid form-header">
	        	<h3>ProvedenĂ­</h3>
	        </div>
	        <div class="container-fluid">
		        <div class="row form-group">
		        	<div class="col-sm-4">
		        		<label for="pocetReseni">Počet řešení</label>
		        	</div>
		        	<div class="col-sm-8">
		            	<input id="pocetReseni" type="number" name="pocetReseni" [(ngModel)]="pocetReseni" #pocetReseniControl="ngModel" min="0" placeholder="Neomezeně" />
		            </div>
		        </div>
		            
		        <div class="row form-group">
		            <div class="col-sm-4">
		            	<label for="vyberAlgoritmu">Algoritmus</label>
		            </div>
		            <div class="col-sm-8">
		            	<p-dropdown name="vyberAlgoritmu" #vyberAlgoritmu="ngModel" [(ngModel)]="selectedAlgorithm" [options]="algoritmy" required></p-dropdown>
		            </div>
			    </div>
		            
		        <div class="row form-group">
		        	<div class="col-sm-4">
		        		<label for="iConsistency">iConsistency</label>
		        	</div>
		        	<div class="col-sm-8">
		        		<input id="iConsistency" type="number" name="iConsistency" [(ngModel)]="iConsistencyFaktor" #pocetReseniControl="ngModel" [disabled]="vyberAlgoritmu.value !== 'iConsistency'" required min="1" />
		        	</div>
		        </div>
		        
		        <div class="row form-group form-submit">
		        	<div class="col-sm-12">
		        		<button type="submit" class="btn btn-success" [disabled]="!provedeniForm.form.valid">Spočti</button>
		            </div>
		        </div>
		    </div>
	    </form>
        
<!-- TODO Co s tim? -->
<!--         <p id="vykonanyAlgoritmus">&nbsp;</p> -->
<!--         <div class="border" style="height: 30%"> -->
<!--                 <app-algoritm [pocetPromennych]="pocetPromennych" *ngIf="(selectedAlgorithm=='Backtracking')"></app-algoritm> -->
<!--             <app-backjumping *ngIf="(selectedAlgorithm=='Backjumping')"></app-backjumping> -->
<!--         </div> -->
    </div>
    
    <div id="vstupySeparator"></div>
    
    <div *ngIf="vybranaPromenna">
	        <div class="backdrop"></div>
	        <div class="modal" tabindex="-1" role="dialog" style="display: block">
	            <div class="modal-dialog" role="document">
	                <div class="modal-content form">
	                    <div class="modal-header form-header">
	                        <button type="button" class="close" aria-label="Close" (click)="closeDialogOmezeni()">
	                            <span aria-hidden="true">&times;</span>
	                        </button>
	                        <h4 class="modal-title">Omezení proměnné {{vybranaPromenna.nazev}}</h4>
	                    </div>
	                    <form  (ngSubmit)="submitDialogOmezeni()" #omezeniForm="ngForm">
	                    <div class="modal-body input-form">
	                    	<div class="modal-scroll container-fluid">
		                        <div *ngFor="let omezeni of vybranaPromenna.omezeni; index as i" class="row form-group">
		                        	<div *ngIf="!omezeni.omezeniProPromennou">
		                        		<div [class]="hodnotaOmezeni.invalid && (hodnotaOmezeni.dirty || hodnotaOmezeni.touched) ? 'text text-danger' : ''">
			                        		<div class="col-sm-1">
			                        			<label for="omezeni{{omezeni.id}}">{{vybranaPromenna.nazev}} {{omezeni.typOmezeni}}</label>
			                        		</div>
			                        		<div class="col-sm-10">
			                        			<span *ngIf="hodnotaOmezeni.invalid && (hodnotaOmezeni.dirty || hodnotaOmezeni.touched)">
			                        				Hodnota je povinná
			                        			</span>
			                        		</div>
		                        		</div>
			                        	<div class="col-sm-1">
			                        		<i class="fa fa-remove text-danger clickable rowHover" (click)="odeberOmezeni(vybranaPromenna, omezeni)"></i>
			                        	</div>
			                        	
										<div class="col-sm-12">		                        	
			                        		<p-multiSelect id="omezeni{{omezeni.id}}" name="omezeni{{omezeni.id}}" #hodnotaOmezeni="ngModel" [(ngModel)]="omezeni.hodnotyOmezeni" [options]="filtrovanePromenne" optionLabel="nazev" maxSelectedLabels="30" required [appendTo]="modalAppendTo"></p-multiSelect>
			                        	</div>
			                        </div>
			                        
			                        <div *ngIf="omezeni.omezeniProPromennou">
			                        	<div class="col-sm-1">
		                        			<label for="omezeni{{omezeni.id}}">{{vybranaPromenna.nazev}} {{omezeni.typOmezeni}} {{omezeni.omezeniProPromennou.nazev}}</label>
		                        		</div>
		                        		<div class="col-sm-10">
		                        			<span *ngIf="domenaOmezeni.invalid && (domenaOmezeni.dirty || domenaOmezeni.touched)" class="text text-danger">
		                        				<span *ngIf="domenaOmezeni.errors.required">Hodnota je povinná</span>
		                        				<span *ngIf="domenaOmezeni.errors.pattern">Je možné zadat pouze dvojice čísel oddělené mezerou</span>
		                        			</span>
		                        		</div>
			                        	<div class="col-sm-1">
			                        		<i class="fa fa-remove text-danger clickable rowHover" (click)="odeberOmezeni(vybranaPromenna, omezeni)"></i>
			                        	</div>
			                        	
										<div class="col-sm-12">		                        	
			                        		<textarea id="omezeni{{omezeni.id}}" name="omezeni{{omezeni.id}}" #domenaOmezeni="ngModel" pInputTextarea rows="4" [(ngModel)]="omezeni.hodnotyOmezeni" required pattern="^(\s*-?\d+\s*,\s*-?\d+\s*)*$"></textarea>
			                        	</div>
			                        </div>
		                        </div>
		                        
		                        <div *ngIf="vybranaPromenna.omezeni?.length === 0" class="row form-group">
		                        	Proměnná nemá žádné omezení. Přidejte jej níže.
		                        </div>
	                        </div>
	                        
	                        <div class="spacer container-fluid">
	                        	<p-dropdown #newTypOmezeni [options]="typyOmezeni" placeholder="Typ"></p-dropdown>
	                        	<p-dropdown [disabled]="!newTypOmezeni.value || jeJednoducheOmezeni(newTypOmezeni.value)" #newCilovaPromenna [options]="filtrovanePromenne" optionLabel="nazev" placeholder="Cil"></p-dropdown>
	                        	<button type="button" class="btn btn-default" [disabled]="!(newTypOmezeni.value && (jeJednoducheOmezeni(newTypOmezeni.value) || newCilovaPromenna.value))" (click)="pridejOmezeni(vybranaPromenna, newTypOmezeni.value, newCilovaPromenna.value)"><i class="fa fa-plus" ></i> Přidat omezení</button>
	                        </div>
	                    </div>
	                    
	                    <div class="modal-footer">
	                        <button type="submit" class="btn btn-success" [disabled]="!omezeniForm.form.valid">Uložit</button>
	                        <button type="button" class="btn btn-danger" (click)="resetDialogOmezeni()">Vrátit</button>
	                        <button type="button" class="btn btn-default" (click)="closeDialogOmezeni()">Zrušit</button>
	                    </div>
	                    </form>
	                </div>
	                <!-- /.modal-content -->
	            </div>
	            <!-- /.modal-dialog -->
	        </div>
        </div>
        <!-- /.modal !-->
      
    <div id="modalAppendTo" #modalAppendTo></div>  
        
    <div id="graf">
		<!-- Kvuli GoJS knihovne a registraci listeneru na DOm je nutne skryvat hidden a ne ngIf -->
    	<div>
	        <div id="myDiagramDiv" [class]="postup? 'graf-plocha' : 'graf-plocha hidden'"></div>
	
			<!--  TODO po presunuti grafu do samostatne komponenty neni nutne -->
			<div *ngIf="postup">
				<div class="graf-podrobnosti">
					{{aktualniKrok?.popis}}
				</div>
		        <div class="graf-navigation">
	                <button (click)="odkrokujCele()">&lt;&lt;&lt;&lt;</button>
	                <button (click)="odkrokujReseni()">&lt;&lt;</button>
	                <button (click)="odkrokuj()">&lt;</button>
	                <span class="graf-step">{{graf.model.undoManager.historyIndex + 1}}</span> / <span class="graf-step">{{postup?.length}}</span>
	                <button (click)="krokuj()">&gt;</button>
	                <button (click)="krokujReseni()">&gt;&gt;</button>
	                <button (click)="krokujCele()">&gt;&gt;&gt;&gt;</button>
		        </div>

	            <div class="graf-zoom">
	                <button (click)="zoomIn()"><i class="fa fa-plus"></i></button>
	                <button (click)="center()"><i class="fa fa-crosshairs"></i></button>
	                <button (click)="zoomOut()"><i class="fa fa-minus"></i></button>
	            </div>
	            
	            <div class="graf-domena">
	            	<h4>Popis domény</h4>
	            	<div class="table-layout">
		            	<div *ngFor="let p of aktualniKrok?.hodnotaDomenKroku">
		            		<div>{{p.nazev}}</div>
		            		<div><span>= &#123;</span>{{p.domena}}<span>&#125;</span></div>
		            	</div>
		            </div>
	            </div>
	        </div>
        </div>
        <div id="navod" *ngIf="!postup">
        	<i class="fa fa-5x fa-edit"></i>
        		<span>Definujte proměnné a jejich omezení.</span>
        		<span>Vyberte algoritmus.</span>
        		<span>Spusťte výpočet.</span>
        </div>
    </div>
</div>

